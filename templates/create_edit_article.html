{% extends 'base.html' %}

{% block title %}
    {% if article_data %}
        Edit Article - {{ article_data.versions[-1].title }}
    {% else %}
        Create New Article
    {% endif %}
{% endblock %}

{% block content %}
    <h1>
        {% if article_data %}
            Edit Article - {{ article_data.versions[-1].title }}
        {% else %}
            Create New Article
        {% endif %}
    </h1>
    <form method="post" {% if article_data %}action="{{ url_for('edit_article', filename=article_data.filename) }}"{% else %}action="{{ url_for('new_article') }}"{% endif %}>
        <div class="form-group">
            <label for="filename">Filename:</label>
            <input type="text" id="filename" name="filename" class="form-control" {% if article_data %}value="{{ article_data.filename }}"{% endif %} required>
            <input type="hidden" id="filename_old" name="filename_old" class="form-control" {% if article_data %}value="{{ article_data.filename }}"{% endif %}>
        </div>
        <div class="form-group">
            <label for="title">Title:</label>
            <input type="text" id="title" name="title" class="form-control" {% if article_data %}value="{{ article_data.versions[-1].title }}"{% endif %} required>
        </div>
        <div class="form-group">
            <label for="tags">Tags (comma-separated):</label>
            <input type="text" id="tags" name="tags" class="form-control" {% if article_data %}value="{{ ', '.join(article_data.versions[-1].tags) }}"{% endif %}>
        </div>
        <div class="form-group">
            <label for="content">Content:</label>
            <textarea id="content" name="content" class="form-control" rows="8" required>{% if article_data %}{{ article_data.versions[-1].content }}{% endif %}</textarea>
        </div>
        <button type="submit" class="btn btn-primary" id="submit-button">
            {% if article_data %}
                Save Changes
            {% else %}
                Create Article
            {% endif %}
        </button>
    </form>
    <script>
        const submitButton = document.getElementById("submit-button");
    
        // Add an event listener to the submit button
        submitButton.addEventListener("click", function() {
            // Manually trigger the form submission
            this.form.submit();
        });
    
        new SimpleMDE({ element: document.getElementById("content") });
    </script>

    <script>
    $('input[name=tags]').tagify();
    </script>
{% endblock %}
